{% extends "graphs/base.html" %}

{% block content %}
<script src="/static/d3.v3.min.js"></script>
<script>

var data = new Array();
        function filter_eid(plotnm, eid) {
        // select all circle children of plotid
        // filter on eid
        plotid = "#" + plotnm;
        plot = d3.select(plotid);
        filtered = plot.selectAll('circle').filter(function(d) {
            return eid == d.eid;
            });
        return filtered;
        }
        

        function plotpoint(newdp, plotnm, classname, size) {
            plotid = "#" + plotnm;
            plot = d3.select(plotid);
            svg = plot.select('svg');
            alldata = data[plotnm].concat(dp)
            circle = svg.selectAll("circle").data(alldata);
            enter = circle.enter().append("circle");
            enter.attr("cx", function(d) { return x(d.x); })
                .attr("cy", function(d) { return height - y(d.y);})
                .attr("class", classname).attr("r", size)
                .attr("id", function(d) { return d.eid+plotid; });
            return enter;
        }

        function get_datapoints_obj(dataset, eid) {
            dp = dataset.filter(function(d) {
               return d.eid == eid;
            });
            return dp;
        }
            
        highlight_point = function(plotid, eid) {
            // remove small dots, replace with big dots
            toremove = filter_eid(plotid, eid);
            dp = get_datapoints_obj(data[plotid], eid);
            points = plotpoint(dp, plotid, "highlightpoints", 5);
            points.attr("onmouseout", "mouseOut(evt)");
            toremove.remove();
        }


</script>

    <div class="container">
      <!-- Example row of columns -->
      <div class="col-lg-2">
        {% if user.is_loggedin %}
        <h4>Senaste tävlingar</h4>
        {% if not racelist %}
        <p>Inga tävlingar hittade!</p>
        {% endif %}
        {% for race in racelist %}
            <p><a href="/race/{{ race.cr_id }}">{{ race.name }}</a></p>
        {% endfor %}
        {% endif %}
      </div>
        <div class="col-lg-6">
        <h4>Plots</h4>
{% if plots.showgraphs %}
<div class="graphcolumn">
{{ plots.plots.splits.render_html|safe}}
{{ plots.plots.bomsplits.render_html|safe}}
{{ plots.plots.behind.render_html|safe}}
{{ plots.plots.legbehind.render_html|safe}}
</div>
<div class="graphcolumn">
{{ plots.plots.totaltime.render_html|safe}}
{{ plots.plots.bomtotal.render_html|safe}}
{{ plots.plots.spread.render_html|safe}}
</div>
{% else %}
No splits found for this race
{% endif %}

       </div>
        <div class="col-lg-2">
            <h4>Resultat</h4>
            <h5>{{ plots.raceinfo.name }}</h5>
            <h5>{{ plots.raceinfo.classname }}</h5>
            <h5>{{ plots.raceinfo.date }}</h5>
            <p>Placering: {{ plots.results.position }}</p>
            <p>Tid: {{ plots.results.time }}</p>
            <p>Status: {{ plots.results.status }}</p>
            <p>Tidsskillnad: {{ plots.results.diff }}</p>
        </div>
    </div>

</div>




{% endblock content %}

</body>
</html>
